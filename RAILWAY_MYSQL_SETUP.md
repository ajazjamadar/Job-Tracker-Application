# Railway MySQL Configuration - Complete Guide

## ‚úÖ Configuration Complete

Your Job Application Tracker is now configured to work with Railway's MySQL database using the exact environment variables that Railway provides.

---

## üîß Railway MySQL Environment Variables

Railway automatically provides these variables when you add a MySQL service:

### Primary Variable (Simplest - Recommended):
```
MYSQL_URL=mysql://root:password@hostname.railway.internal:3306/railway
```

### Individual Variables (Also Available):
```
MYSQLUSER=root
MYSQLPASSWORD=<auto-generated-32-char-password>
MYSQLHOST=<container>.railway.internal
MYSQLPORT=3306
MYSQLDATABASE=railway
```

### Additional Variables (Aliases):
```
MYSQL_ROOT_PASSWORD=<same as MYSQLPASSWORD>
MYSQL_DATABASE=<same as MYSQLDATABASE>
MYSQL_PUBLIC_URL=<public TCP proxy URL>
```

---

## üéØ How Your App Uses These Variables

### Priority 1: Use MYSQL_URL (Easiest)
```python
if os.environ.get('MYSQL_URL'):
    # Railway provides: mysql://user:pass@host:3306/db
    # App converts to: mysql+mysqlconnector://user:pass@host:3306/db
    SQLALCHEMY_DATABASE_URI = MYSQL_URL.replace('mysql://', 'mysql+mysqlconnector://')
```

### Priority 2: Build from Individual Variables
```python
elif all([MYSQLUSER, MYSQLPASSWORD, MYSQLHOST, MYSQLDATABASE]):
    SQLALCHEMY_DATABASE_URI = f"mysql+mysqlconnector://{MYSQLUSER}:{MYSQLPASSWORD}@{MYSQLHOST}:{MYSQLPORT}/{MYSQLDATABASE}"
```

### Priority 3: Use SQLite (Local Development)
```python
else:
    SQLALCHEMY_DATABASE_URI = 'sqlite:///app.db'
```

---

## üöÄ Railway Deployment Steps

### Step 1: Create Railway Project
1. Go to https://railway.app
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your repository
5. Add MySQL service: Click "+" ‚Üí "Database" ‚Üí "Add MySQL"

### Step 2: Configure Environment Variables

Railway automatically provides MySQL variables. You only need to add these:

```env
# Required
SECRET_KEY=8fbde59b29c91530935e31bc6aa33f8875b13ac950975c1ce99190c1d3472490

# Production Settings
FLASK_DEBUG=0

# Logging
LOG_LEVEL=INFO
LOG_FILE=app.log

# Mailgun Email
MAILGUN_API_KEY=your-mailgun-api-key-here
MAILGUN_DOMAIN=your-sandbox-domain.mailgun.org
MAIL_SERVER=smtp.mailgun.org
MAIL_PORT=587
MAIL_USE_TLS=1
MAIL_USERNAME=postmaster@your-sandbox-domain.mailgun.org
MAIL_PASSWORD=your-mailgun-api-key-here
MAIL_DEFAULT_SENDER=Job Tracker <postmaster@your-sandbox-domain.mailgun.org>
```

**DO NOT SET** these (Railway provides them automatically):
- ‚ùå MYSQL_URL
- ‚ùå MYSQLUSER
- ‚ùå MYSQLPASSWORD
- ‚ùå MYSQLHOST
- ‚ùå MYSQLPORT
- ‚ùå MYSQLDATABASE

### Step 3: Deploy
```bash
# Railway automatically detects and deploys from your repo
# Or use Railway CLI:
railway up
```

### Step 4: Initialize Database

After first deployment, create the database tables:

```bash
# Method 1: Using Railway CLI
railway run python -c "from app import create_app, db; app = create_app(); app.app_context().push(); db.create_all(); print('Tables created!')"

# Method 2: Using Railway Dashboard
# Go to your app ‚Üí Settings ‚Üí Deploy Logs ‚Üí Click "shell" icon
# Then run:
python -c "from app import create_app, db; app = create_app(); app.app_context().push(); db.create_all()"

# Method 3: Using Flask-Migrate (if migrations exist)
railway run flask db upgrade
```

---

## üß™ Testing Locally with Railway MySQL

If you want to test with Railway MySQL from your local machine:

### Option 1: Use MYSQL_URL
Add to your `.env` file:
```env
MYSQL_URL=mysql://root:your_password@hostname.railway.internal:3306/railway
```

### Option 2: Use Individual Variables
Add to your `.env` file:
```env
MYSQLUSER=root
MYSQLPASSWORD=your_password_from_railway
MYSQLHOST=hostname.railway.internal
MYSQLPORT=3306
MYSQLDATABASE=railway
```

Then test:
```bash
python test_mysql_connection.py
```

**Note:** You can find these values in Railway Dashboard ‚Üí MySQL service ‚Üí Variables tab

---

## üìã Files Modified for Railway

### ‚úÖ config.py
- Auto-detects `MYSQL_URL` and converts to SQLAlchemy format
- Falls back to individual variables if MYSQL_URL not available
- Uses SQLite for local development

### ‚úÖ requirements.txt
- Already has `mysql-connector-python>=8.0.23`

### ‚úÖ Procfile
- `web: gunicorn wsgi:app` (ready for Railway)

### ‚úÖ wsgi.py
- Entry point configured

---

## üîç Verifying Configuration

### Check Current Database:
```bash
python -c "from app import create_app; app = create_app(); print(app.config['SQLALCHEMY_DATABASE_URI'])"
```

### Expected Output:
**Local (no Railway vars):**
```
sqlite:///app.db
```

**Railway (with MYSQL_URL):**
```
mysql+mysqlconnector://root:****@hostname.railway.internal:3306/railway
```

---

## üéØ Key Differences from Previous Setup

| Previous | Now (Railway Actual) |
|----------|---------------------|
| `MYSQL_ROOT_PASSWORD` | `MYSQLPASSWORD` |
| `RAILWAY_PRIVATE_DOMAIN` | `MYSQLHOST` |
| `MYSQL_DATABASE` | `MYSQLDATABASE` |
| Build manually | Use `MYSQL_URL` directly |

---

## ‚ú® Current Status

- ‚úÖ **Local Development:** Uses SQLite (no MySQL needed)
- ‚úÖ **Railway Deployment:** Auto-detects and uses MySQL
- ‚úÖ **Variable Names:** Match Railway's actual variables
- ‚úÖ **MYSQL_URL Support:** Primary method (simplest)
- ‚úÖ **Fallback Support:** Can use individual variables
- ‚úÖ **Testing Scripts:** Updated for Railway variables
- ‚úÖ **Documentation:** Complete deployment guide

---

## üö¶ Ready to Deploy!

Your application will:
1. **Automatically detect** Railway's MySQL variables
2. **Use MYSQL_URL** if available (easiest)
3. **Fall back** to individual variables if needed
4. **Use SQLite locally** for development
5. **No manual configuration needed** on Railway

Just push your code and add the non-MySQL environment variables!

---

## üìû Troubleshooting

### App uses SQLite on Railway
**Problem:** App still using SQLite instead of MySQL
**Solution:** 
1. Check Railway Dashboard ‚Üí Your App ‚Üí Variables
2. Verify `MYSQL_URL` exists
3. Restart the deployment

### Connection Timeout
**Problem:** Can't connect to MySQL
**Solution:**
1. Ensure MySQL service is running in Railway
2. Check that app and MySQL are in same Railway project
3. Railway automatically handles networking

### Tables Don't Exist
**Problem:** Database connection works but tables are empty
**Solution:** Run the initialization command:
```bash
railway run python -c "from app import create_app, db; app = create_app(); app.app_context().push(); db.create_all()"
```

### Check Railway Logs
```bash
railway logs
```

---

## üéâ You're All Set!

Push your code to Railway and you're done! The app will automatically:
- Connect to MySQL using Railway's variables
- Work seamlessly without any manual configuration
- Scale with Railway's infrastructure

Questions? Check `RAILWAY_DEPLOYMENT.md` for more details.




